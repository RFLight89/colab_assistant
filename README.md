# colab_assistant
assistant for collecting data about user's colab notebooks and describe code in it. Include LLM query for answering about content in data.

# Ru
Некоторые размышления привели меня к мысли, что раз я изучаю нейросети, то было бы здорово иметь собственного помощника для систематизации моего пройденного курса и выполненных домашних заданий. Такой момент как раз представился в данном задании.

Стоит начать сразу с описания задуманного помощника, т.к. это является частью оптимизации проекта.

Предполагается, что ноутбук с домашней работой в colab создан как копия оригинального ноутбука с заданием, сохраняя в названии номер и текст "Домашняя работа".

Помощник будет спроектирован со следующими этапами, функциями и целями:

1) **Структурирование записей:**
- получение ссылок ноутбуков учетной записи в колабе:
    - авторизация на гугл драйв через API Google Colab Magic
    - запрос ноутбуков
- обработка каждой ссылки:
    - фильтрация блокнотов "untitled";
    - проверка поля "Владелец", чтобы определить, чей это ноутбук (колонка для развития проекта, т.к. в текущей версии видны только мои ноутбуки);
    - ~~проверка наличия текста "Домашняя работа" в названии  для выделения ноутбуков с домашними работами;~~
    - ~~проверка наличия заголовка "Итог" в теле ноутбука как индикатора завершенной работы. Данный заголовок в последующем стоит рассматривать как необходимый в домашних работах, т.к. этот проект может вырасти из статуса пет-проекта в полноценное приложение.~~
    - ~~если заголовок "Итог" отсутствует в блокноте домашней работы (см. пункт выше) - помечать блокнот как незаконченный.~~
    
    Обновлено:    
    - извлечение названия ноутбука;
    - извлечение навигации по уроку:
        - нахождение текста без ссылки в навигации к уроку и внесение его в колонку 'навигация';
    - извлечение всех заголовков ноутбука и внечение их в колонку 'Заголовки' в датафрейме;
    - извлечение текста после заголовка 'Итог', если такой имеется, если нет - отмечать его отстутствие, значение далее вносится в поле 'Итог' датафрейма;
   
- упорядочивание работ по номеру задания, которое берется из названия ноутбука;
- анализ кода в работах с помощью библиотеки ast:
    - извлечение классов;
    - извлечение функций;
    - передача в LLM класса/функции для получения краткого описания в виде
    ```
    Заголовок 1 уровня (Класс/Функция)
    Заголовок 2 уровня (логическая задача)
    Заголовок 3 уровня (краткое описание способа выполнения задачи)
    ```
     Предполагается использование LangChain для данного пункта.
     Для передачи в LLM сложных наборов классов/функций используется следующий метод:
        - 1. передача функций класса для получения описания
        - 2. получение описаний функций в классе от LLM
        - 3. передача в LLM класса с кратким описанием функций, полученных на предыдущем шаге
        - 4. получение описания класса
    - извлечение импортов;

- расчет хэша для ноутбуков;
- создание по итогу обработки найденных страниц из профиля документа-датафрейма с колонками:
    - 'ссылка': ссылка на ноутбук, метаданные в Chroma;
    - 'название': название ноутбука, документ в Chroma;
    - ~~задание;~~ ~~'навигация': название темы работы страницы из текстового блока навигации, документ в Chroma;~~
    - 'заголовки': текст заголовков любого уровня в уроке, документ в Chroma;
    - 'библиотеки': найденные импорты, метаданные в Chroma;
    - 'классы и функции': найденные классы и функции на странице, метаданные в Chroma;
    - 'описание': краткое описание от LLM классов и функций, документ в Chroma;
    - 'итог': итог выполненной работы, созданный из краткого описания текстового поля после заголовка "Итог" в работе, если такого поля нет - то так и добавляется значение "Нет", документ в Chroma;
    - 'хэш': хэш ноутбука, метаданные в Chroma.
- возможность сохранить и скачать документ локально в формате .csv и в гугл драйв по пути "/content/drive/MyDrive/assistant/database.csv".

2) **Создание векторной базы ChromaDB из структурированного документа:**
- создание базы из подготовленного датафрейма;
- индексирование документов в базе для последующего поиска;
- сохранение индексированной базы в гугл драйв пользователя с путем по умолчанию "/content/drive/MyDrive/assistant/chroma_db";
- загрузка индексов из гугл драйва для последующего использования.

3) **Создание ассистента для поиска данных в базе по запросам пользователя:**
- создать выбор моделей для работы ассистента;
- ассистент должен имееть функцию подсчета токенов через библиотеку tiktoken, необходимых для исполнения запроса к указанной модели;
- ассистент формирует запрос к выбранной LLM модели с параметрами:
    - промпт ассистента - поле с указанными параметрами по умолчанию с возможностью редактирования + найденные по схожести запроса пользователя документы в индексированной базе Chroma;
    - промпт запроса - поле с запросом пользователя;

4) **Создание интерфейса с использованием Gradio. Должен включать:**
- авторизацию в гугл драйв через всплывающее окно (временное решение, которое работает только при запуске в colab);
- поле с информацией об ассистенте:
    - название (тип) ассистента;
    - промпт ассистента;
- статус базы:
    - "не создана"/"создана"
    - поле для выбора пути для загрузки базы с указанным путем по умолчанию "/content/drive/MyDrive/assistant/chroma_db"
    - кнопка загрузки, которая подключает базу по указанному пути
    - статус меняется на "загружена", если использовалась успешная загрузка
    - статус меняется на "ошибка загрузки" при неудачной загрузке
- кнопка создания базы, если база не создана и не загружена
- область сохранения базы на локальное устройство:
    - поле с указанием пути до файла
    - кнопка сохранения: не активна, пока не существует датафрейма по пути гугл драйв (по умолчанию "/content/drive/MyDrive/assistant/database.csv")
    - кнопка сохранения: активна, когда файл по пути "/content/drive/MyDrive/assistant/database.csv" существует, либо указан путь к файлу.
- область запроса пользователя:
    - поле для ввода текста запроса с возможностью редактирования;
    - поле с ответом от ассистента:
        - ответ от LLM в текстовом виде
        - добавление метаданных из полей датафрейма, которые нашел ассистен в индексах: ссылка на ноутбук, название, задание, статус работы.
- область статистики:
    - количество использованных токенов в запросе
**Добавлено в процессе:**
- пргресс-бар от обработки до создания базы

**Возможные последующие доработки:**

Дообучение ассистента:
- возможность проверять драйв на появление новых ссылок ноутбуков и добавлять данные в датафрейм и векторную базу
- возможность изменять статус ноутбука
- возможность обновлять существующие записи при изменении ноутбука из базы (предположительно на основе изменения хэша ноутбуков)
    ...
